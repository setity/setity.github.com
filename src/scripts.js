let textContent="";function showPage(e){const t=document.getElementsByClassName("page");for(let e=0;e<t.length;e++)t[e].style.display="none";const n=document.getElementById("page"+e);n&&(n.style.display="block");const o=document.getElementsByClassName("pageButton");for(let e=0;e<o.length;e++)o[e].classList.remove("currentPage");const l=document.getElementById("fileInput");if(l.files.length>0){const t=l.files[0].name;localStorage.setItem(t+"_currentPage",e)}updatePageButtons(e),window.scrollTo(0,0);const a=document.getElementById("scrollInfo");a.textContent=`第 ${e} 页，朗读请点击地址栏末尾的朗读按钮`,a.style.color="red",a.style.fontWeight="bold",setTimeout((function(){a.textContent=""}),4e3),document.getElementById("searchResults").innerHTML=""}function updatePageButtons(e){const t=document.getElementById("pageButtons"),n=document.getElementsByClassName("page").length,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?3:5;if(t.innerHTML="",n>1&&e>1){const n=document.createElement("span");n.classList.add("pageButton"),n.innerText="上一页",n.addEventListener("click",(function(){showPage(e-1)})),t.appendChild(n)}let l=e-Math.floor(o/2),a=e+Math.floor(o/2);if(l<1&&(l=1,a=Math.min(n,o)),a>n&&(a=n,l=Math.max(1,n-o+1)),l>1){const e=document.createElement("span");if(e.classList.add("pageButton"),e.innerText="1",e.addEventListener("click",(function(){showPage(1)})),t.appendChild(e),l>2){const e=document.createElement("span");e.innerText="...",t.appendChild(e)}}for(let n=l;n<=a;n++){const o=document.createElement("span");o.classList.add("pageButton"),o.innerText=n,n===e&&o.classList.add("currentPage"),o.addEventListener("click",(function(){showPage(n)})),t.appendChild(o)}if(a<n){if(a<n-1){const e=document.createElement("span");e.innerText="...",t.appendChild(e)}const e=document.createElement("span");e.classList.add("pageButton"),e.innerText=n,e.addEventListener("click",(function(){showPage(n)})),t.appendChild(e)}if(n>1&&e<n){const n=document.createElement("span");n.classList.add("pageButton"),n.innerText="下一页",n.addEventListener("click",(function(){showPage(e+1)})),t.appendChild(n)}}function initializeSettings(){const e="#f4f4f4",t="16px",n="#000000",o="normal",l="1",a={backgroundColor:localStorage.getItem("backgroundColor")||e,fontSize:localStorage.getItem("fontSize")||t,fontColor:localStorage.getItem("fontColor")||n,fontWeight:localStorage.getItem("fontWeight")||o,lineHeight:localStorage.getItem("lineHeight")||l};document.body.style.backgroundColor=a.backgroundColor,document.getElementById("backgroundColorSelect").value=a.backgroundColor,document.getElementById("fontSizeInput").value=a.fontSize.replace("px",""),document.getElementById("fontColorSelect").value=a.fontColor,document.getElementById("fontWeightSelect").value=a.fontWeight,document.getElementById("lineHeightInput").value=a.lineHeight,updatePagesStyles(a)}function updatePagesStyles(e){var t=document.createElement("style");t.innerHTML=`\n  .page {\n         display: none; \n         font-size: ${e.fontSize};\n          font-weight: ${e.fontWeight};\n         color: ${e.fontColor};\n         background-color: ${e.backgroundColor};\n        }\n  p {\n    line-height: ${e.lineHeight};\n    }\n  `,document.head.appendChild(t)}function updateSetting(e,t){localStorage.setItem(e,t);updatePagesStyles({backgroundColor:localStorage.getItem("backgroundColor"),fontSize:localStorage.getItem("fontSize"),fontColor:localStorage.getItem("fontColor"),fontWeight:localStorage.getItem("fontWeight"),lineHeight:localStorage.getItem("lineHeight")})}document.getElementById("loadFileButton").addEventListener("click",(function(){document.getElementById("fileInput").click()})),document.getElementById("fileInput").addEventListener("change",(function(){const e=this.files[0];if(e){const t=new FileReader;t.onload=function(t){textContent=t.target.result,document.getElementById("content").innerHTML="",document.getElementById("pageButtons").innerHTML="",document.getElementById("searchResults").innerHTML="";const n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?6e3:1e4;let o="",l=textContent.split("\n"),a=0,i="",d=1;for(let e=0;e<l.length;e++)i+="<p>"+l[e]+"</p>",a+=l[e].length,a>=n&&(o+='<div class="page" id="page'+d+'">'+i+"</div>",a=0,i="",d++);""!==i&&(o+='<div class="page" id="page'+d+'">'+i+"</div>"),document.getElementById("content").innerHTML=o,document.getElementById("fileSelection").style.display="none",document.getElementById("pageTitle").style.display="none",document.getElementById("readme").style.display="none";const c=e.name,s=localStorage.getItem(c+"_currentPage");showPage(s?parseInt(s):1)},t.readAsText(e)}})),document.getElementById("searchButton").addEventListener("click",(function(){const e=document.getElementById("searchInput").value.trim();if(""===e)return;const t=document.getElementsByClassName("page"),n=document.getElementById("searchResults");n.innerHTML="";let o=0;for(let l=0;l<t.length;l++){const a=t[l].textContent,i=a.indexOf(e);if(-1!==i){const t=a.substring(Math.max(0,i-50),i),d=a.substring(i,i+e.length),c=a.substring(i+e.length,i+e.length+50),s=document.createElement("div");s.innerHTML=`${t}<span class="highlight">${d}</span>${c}`,s.classList.add("searchResult"),s.addEventListener("click",(function(){showPage(l+1),n.innerHTML=""})),n.appendChild(s),o++,window.scrollBy({top:600,behavior:"smooth"})}}if(0===o){const e=document.createElement("div");e.textContent="未找到匹配结果。",e.classList.add("searchResult"),n.appendChild(e)}})),document.getElementById("netsearchButton").addEventListener("click",(function(){var e=document.getElementById("searchInput").value;if(""!==e.trim()){var t="https://www.bing.com/search?q="+encodeURIComponent(e+"txt下载");window.open(t,"_blank")}else alert("请输入搜索关键词！")})),window.addEventListener("DOMContentLoaded",initializeSettings),document.getElementById("backgroundColorSelect").addEventListener("change",(function(){const e=this.value;document.body.style.backgroundColor=e,updateSetting("backgroundColor",e)})),document.getElementById("fontSizeInput").addEventListener("change",(function(){updateSetting("fontSize",this.value+"px")})),document.getElementById("fontColorSelect").addEventListener("change",(function(){updateSetting("fontColor",this.value)})),document.getElementById("fontWeightSelect").addEventListener("change",(function(){updateSetting("fontWeight",this.value)})),document.getElementById("lineHeightInput").addEventListener("change",(function(){updateSetting("lineHeight",this.value)}));